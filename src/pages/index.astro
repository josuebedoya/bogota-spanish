---
import LayoutPage from "@/layouts/LayoutPage.astro";
import directus, { directusMedia } from "@/server/directus";
import { readItems } from "@directus/sdk";
import { staticData } from "@/server/static-data";
import MainBannerHome from "@/components/orgnisms/MainBannerHome.astro";
import BannerHome2 from "@/components/orgnisms/BannerHome2.astro";
import SpanishCoursesHome from "@/components/orgnisms/SpanishCoursesHome.astro";
import Faq from "@/components/orgnisms/Faq.astro";
import WhatSayOurStudents from "@/components/orgnisms/WhatSayOurStudents.astro";
import BannerTypeTwo from "@/components/species/BannerTypeTwo.astro";
const data = await directus?.request(readItems("Home"));
const fileBanner = await directusMedia(data?.Image_Main_Banner || "");
const fileBanner2 = await directusMedia(data?.Image_Levels_Starting || "");

const dataMainBanner = {
  phrase: data?.Phrase_Main_Banner,
  title: data?.Title_Main_Banner,
  summary: data?.Summary_Main_Banner,
  button1: {
    text: data?.Button1_Main_Banner,
    link: "/book-a-free-class",
  },
  button2: {
    text: data?.Button2_Main_Banner,
    link: "/spanish-courses",
  },
  image: fileBanner?.src_path,
};

const dataBanner2 = {
  phrase: data?.Phrase_Levels_Starting,
  title: data?.Title_Levels_Starting,
  summary: data?.Summary_Levels_Starting,
  titleList: data?.Phrase_Title_List_Levels_Starting,
  listLevels: data?.List_Levels_Starting,
  button: {
    label: data?.Button_Levels_Starting,
    link: "/about-us",
  },
  image: fileBanner2?.src_path,
};

const dataCourses = await directus?.request(
  readItems("Home", {
    filter: { id: { _eq: 2 } },
    fields: ["Courses_List.Courses_id.*"],
  }),
);

const itemsCourses = await Promise.all(
  dataCourses?.Courses_List?.map(async (course: any) => {
    return {
      icon: course?.Courses_id?.icon || "",
      title: course?.Courses_id?.shurt_title || "",
      summary: course?.Courses_id?.summary || "",
    };
  }) || [],
);
const dataSpanishCourses = {
  title: data?.Title_List_Courses,
  phrase: data?.Summary_List_Courses,
  items: itemsCourses,
};

const dataStories = await directus?.request(
  readItems("Home", {
    filter: { id: { _eq: 2 } },
    fields: ["Stories.Stories_id.*"],
  }),
);

const itemsStudents = await Promise.all(
  dataStories?.Stories?.map(async (story: any) => {
    const fileImage = await directusMedia(
      story?.Stories_id?.Video_Or_Image || "",
    );
    return {
      title: story?.Stories_id?.Title_Story,
      summary: story?.Stories_id?.Summary_Story,
      image: fileImage?.src_path,
      videoUrl: story?.Stories_id?.Url_Video,
    };
  }) || [],
);

const dataSayOurStudents = {
  phrase: data?.Summary_What_Our_Studens,
  title: data?.Title_What_Our_Students,
  items: itemsStudents,
};

const dataBookingTasterSession = {
  title: data?.Title_Tester_Session,
  summary: data?.Summary_Tester_Session,
  button: {
    label: data?.Button_Tester_Session,
    link: "/book-a-free-class",
  },
  image: "/assets/img/home/booking-a-tester.png",
};

const dataFaq = {
  title: data?.Title_FAQ,
  summary: data?.Summary_FAQ,
  items: data?.List_FAQ.map((el: any) => ({
    title: el?.Title,
    body: el?.Body,
  })),
};
---

<LayoutPage
  title={staticData.home.title}
  description={staticData.home.description}
>
  <MainBannerHome {...dataMainBanner} />
  <BannerHome2 {...dataBanner2} />
  <SpanishCoursesHome {...dataSpanishCourses} />
  <WhatSayOurStudents {...dataSayOurStudents} />
  <BannerTypeTwo {...dataBookingTasterSession} />
  <Faq {...dataFaq} />
</LayoutPage>
